<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–Ñ–†–î–† PRO - –û–±'—î–¥–Ω–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞</title>
    <style>
        /* ... –≤—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>

    <div class="container">
        <!-- ... –≤–µ—Å—å HTML –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–æ —Å–∫—Ä–∏–ø—Ç–∞ ... -->
    </div>

    <script>
        // üîê 24 –ê–ë–°–û–õ–Æ–¢–ù–û –†–Ü–ó–ù–ò–• –ü–ê–†–û–õ–Ø
        const USERS = {
            gunp: [
                { username: "gunp_admin", password: "BlueDragon2024", name: "–ö–æ–≤–∞–ª–µ–Ω–∫–æ –Ü.–ü.", position: "–ì–æ–ª–æ–≤–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –ì–£–ù–ü" },
                { username: "gunp_director", password: "PoliceGuard987", name: "–ü–µ—Ç—Ä–µ–Ω–∫–æ –û.–í.", position: "–ù–∞—á–∞–ª—å–Ω–∏–∫ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è" },
                { username: "gunp_deputy", password: "SecureBase555", name: "–®–µ–≤—á–µ–Ω–∫–æ –ú.–Ü.", position: "–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞" },
                { username: "gunp_senior", password: "Investigator777", name: "–ë–æ–Ω–¥–∞—Ä–µ–Ω–∫–æ –°.–ü.", position: "–°—Ç–∞—Ä—à–∏–π —Å–ª—ñ–¥—á–∏–π" },
                { username: "gunp_invest", password: "CrimeHunter333", name: "–°–∏–¥–æ—Ä–µ–Ω–∫–æ –í.–ü.", position: "–°–ª—ñ–¥—á–∏–π" },
                { username: "gunp_oper", password: "PatrolAgent111", name: "–ö—Ä–∞–≤—á–µ–Ω–∫–æ –ê.–ú.", position: "–û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∏–∫" },
                { username: "gunp_analyst", password: "DataAnalyzer999", name: "–ü–∞–≤–ª–µ–Ω–∫–æ –Ü.–í.", position: "–ê–Ω–∞–ª—ñ—Ç–∏–∫" },
                { username: "gunp_tech", password: "TechSupport444", name: "–¢–∫–∞—á—É–∫ –†.–û.", position: "–¢–µ—Ö–Ω—ñ—á–Ω–∏–π —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç" }
            ],
            sbu: [
                { username: "sbu_admin", password: "RedShadow2024", name: "–ú–µ–ª—å–Ω–∏–∫ –ê.–í.", position: "–ì–æ–ª–æ–≤–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –°–ë–£" },
                { username: "sbu_counter", password: "CounterSpy789", name: "–ö–æ–≤–∞–ª—å—á—É–∫ –°.–ú.", position: "–ù–∞—á–∞–ª—å–Ω–∏–∫ –∫–æ–Ω—Ç—Ä—Ä–æ–∑–≤—ñ–¥–∫–∏" },
                { username: "sbu_senior", password: "SecretAgent456", name: "–¢–∫–∞—á–µ–Ω–∫–æ –Ü.–ü.", position: "–°—Ç–∞—Ä—à–∏–π –æ–ø–µ—Ä—É–ø–æ–≤–Ω–æ–≤–∞–∂–µ–Ω–∏–π" },
                { username: "sbu_oper", password: "UnderCover123", name: "–õ–∏—Å–µ–Ω–∫–æ –û.–†.", position: "–û–ø–µ—Ä—É–ø–æ–≤–Ω–æ–≤–∞–∂–µ–Ω–∏–π" },
                { username: "sbu_cyber", password: "CyberShield321", name: "–®–µ–≤—á—É–∫ –ú.–°.", position: "–ö—ñ–±–µ—Ä—Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç" },
                { username: "sbu_analyst", password: "IntelMaster654", name: "–ë—ñ–ª–∏–π –í.–ü.", position: "–ê–Ω–∞–ª—ñ—Ç–∏–∫ —Ä–æ–∑–≤—ñ–¥–∫–∏" },
                { username: "sbu_security", password: "SafeGuard987", name: "–ß–æ—Ä–Ω–∏–π –û.–Ü.", position: "–°–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç –±–µ–∑–ø–µ–∫–∏" },
                { username: "sbu_tech", password: "TechWizard555", name: "–ó–µ–ª–µ–Ω—Å—å–∫–∏–π –ü.–ú.", position: "–¢–µ—Ö–Ω—ñ—á–Ω–∏–π –µ–∫—Å–ø–µ—Ä—Ç" }
            ],
            prosecutor: [
                { username: "proc_admin", password: "GoldScale2024", name: "–í—ñ—Å–∫–∞—Ä –ú.–ú.", position: "–ì–æ–ª–æ–≤–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –ü—Ä–æ–∫—É—Ä–∞—Ç—É—Ä–∏" },
                { username: "proc_general", password: "JusticeLord777", name: "–ö—É–ª–µ–±—è–∫–∞ –ê.–ê.", position: "–ì–µ–Ω–µ—Ä–∞–ª—å–Ω–∏–π –ø—Ä–æ–∫—É—Ä–æ—Ä" },
                { username: "proc_deputy", password: "LawMaster888", name: "–ú–∞—Ä–∫—ñ—î–Ω–∫–æ –ú.–°.", position: "–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –ø—Ä–æ–∫—É—Ä–æ—Ä–∞" },
                { username: "proc_senior", password: "SeniorLaw555", name: "–®–º–µ–ª–µ–≤ –ê.–Ñ.", position: "–°—Ç–∞—Ä—à–∏–π –ø—Ä–æ–∫—É—Ä–æ—Ä" },
                { username: "proc_dept", password: "DeptChief333", name: "–ü–µ—Ç—Ä–æ–≤ –ö.–û.", position: "–ü—Ä–æ–∫—É—Ä–æ—Ä –≤—ñ–¥–¥—ñ–ª—É" },
                { username: "proc_assist", password: "LegalAid111", name: "–Ü–≤–∞–Ω–æ–≤–∞ –õ.–ú.", position: "–ü–æ–º—ñ—á–Ω–∏–∫ –ø—Ä–æ–∫—É—Ä–æ—Ä–∞" },
                { username: "proc_criminal", password: "CrimeLaw222", name: "–°–µ–º–µ–Ω—é–∫ –í.–Ü.", position: "–ü—Ä–æ–∫—É—Ä–æ—Ä-–∫—Ä–∏–º—ñ–Ω–∞–ª—ñ—Å—Ç" },
                { username: "proc_super", password: "Supervisor999", name: "–ö–æ–∑–∞–∫ –†.–°.", position: "–°–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç –∑ –Ω–∞–≥–ª—è–¥—É" }
            ],
            admin: [
                { username: "system_admin", password: "MasterControl2024", name: "–°–∏—Å—Ç–µ–º–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä", position: "–ì–æ–ª–æ–≤–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä" }
            ]
        };

        // –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö —Å–ø—Ä–∞–≤
        let CASES_DATABASE = {
            gunp: [],
            sbu: [],
            prosecutor: []
        };

        // üî• –°–ò–°–¢–ï–ú–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø
        const SYSTEM_LOGS = {
            logs: [],
            securityAlerts: []
        };

        // –¢–∏–ø—ã –ª–æ–≥–æ–≤
        const LOG_TYPES = {
            LOGIN: 'login',
            LOGOUT: 'logout',
            CREATE_CASE: 'create',
            DELETE_CASE: 'delete',
            VIEW_CASE: 'view',
            EXPORT_DATA: 'export',
            SYSTEM: 'system'
        };

        let currentAgency = null;
        let currentUser = null;
        let caseToDelete = null;

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ IP
        function generateRandomIP() {
            return `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
        }

        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function logAction(type, action, details = {}, user = null, agency = null) {
            const logEntry = {
                id: Date.now() + Math.random(),
                timestamp: new Date().toISOString(),
                type: type,
                action: action,
                details: details,
                user: user || (currentUser ? currentUser.name : '–°–∏—Å—Ç–µ–º–∞'),
                username: user ? user.username : (currentUser ? currentUser.username : 'system'),
                agency: agency || currentAgency || 'system',
                ip: generateRandomIP(),
                userAgent: navigator.userAgent
            };

            SYSTEM_LOGS.logs.unshift(logEntry);
            saveLogsToStorage();

            // –û–±–Ω–æ–≤–ª—è–µ–º UI –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –ø–∞–Ω–µ–ª—å –ª–æ–≥–æ–≤
            if (document.getElementById('admin-logs').style.display !== 'none') {
                renderLogs();
            }

            console.log(`üìù LOG [${type}]: ${action}`, logEntry);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤
        function saveLogsToStorage() {
            try {
                localStorage.setItem('erdr_system_logs', JSON.stringify(SYSTEM_LOGS.logs.slice(0, 1000)));
            } catch (e) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ª–æ–≥—ñ–≤:', e);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤
        function loadLogsFromStorage() {
            try {
                const savedLogs = localStorage.getItem('erdr_system_logs');
                if (savedLogs) {
                    SYSTEM_LOGS.logs = JSON.parse(savedLogs);
                }
            } catch (e) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª–æ–≥—ñ–≤:', e);
            }
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
        function renderLogs(filteredLogs = null) {
            const logsToRender = filteredLogs || SYSTEM_LOGS.logs;
            const container = document.getElementById('logs-container');
            
            container.innerHTML = logsToRender.map(log => `
                <div class="log-item log-type-${log.type}">
                    <div class="log-info">
                        <div class="log-action">${getLogActionText(log)}</div>
                        <div class="log-details">${getLogDetailsText(log)}</div>
                        <div class="log-meta">
                            <span>üë§ ${log.user}</span>
                            <span>üè¢ ${getAgencyName(log.agency)}</span>
                            <span>üåê <span class="log-ip">${log.ip}</span></span>
                            <span>üïí ${new Date(log.timestamp).toLocaleString('uk-UA')}</span>
                        </div>
                    </div>
                    <div class="badge badge-${getLogStatusColor(log)}">${getLogTypeText(log.type)}</div>
                </div>
            `).join('');

            populateUserFilter();
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
        function getLogActionText(log) {
            const actions = {
                [LOG_TYPES.LOGIN]: `–í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É`,
                [LOG_TYPES.LOGOUT]: `–í–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏`,
                [LOG_TYPES.CREATE_CASE]: `–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–ø—Ä–∞–≤–∏`,
                [LOG_TYPES.DELETE_CASE]: `–í–∏–¥–∞–ª–µ–Ω–Ω—è —Å–ø—Ä–∞–≤–∏`,
                [LOG_TYPES.VIEW_CASE]: `–ü–µ—Ä–µ–≥–ª—è–¥ —Å–ø—Ä–∞–≤–∏`,
                [LOG_TYPES.EXPORT_DATA]: `–ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö`,
                [LOG_TYPES.SYSTEM]: `–°–∏—Å—Ç–µ–º–Ω–∞ –ø–æ–¥—ñ—è`
            };
            return actions[log.type] || log.action;
        }

        function getLogDetailsText(log) {
            switch (log.type) {
                case LOG_TYPES.LOGIN:
                    return `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${log.details.username} ‚Ä¢ –°—Ç–∞—Ç—É—Å: ${log.details.status === 'success' ? '–£—Å–ø—ñ—à–Ω–æ' : '–ù–µ–≤–¥–∞–ª–æ'}`;
                case LOG_TYPES.CREATE_CASE:
                    return `–°–ø—Ä–∞–≤–∞: ${log.details.caseNumber} ‚Ä¢ ${log.details.caseTitle}`;
                case LOG_TYPES.DELETE_CASE:
                    return `–°–ø—Ä–∞–≤–∞: ${log.details.caseNumber} ‚Ä¢ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ: ${log.details.confirmedBy}`;
                case LOG_TYPES.VIEW_CASE:
                    return `–°–ø—Ä–∞–≤–∞: ${log.details.caseNumber}`;
                case LOG_TYPES.EXPORT_DATA:
                    return `–ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ: ${log.details.recordCount} –∑–∞–ø–∏—Å—ñ–≤`;
                default:
                    return log.details.message || '';
            }
        }

        function getLogTypeText(type) {
            const types = {
                [LOG_TYPES.LOGIN]: '–í–•–Ü–î',
                [LOG_TYPES.LOGOUT]: '–í–ò–•–Ü–î',
                [LOG_TYPES.CREATE_CASE]: '–°–¢–í–û–†–ï–ù–ù–Ø',
                [LOG_TYPES.DELETE_CASE]: '–í–ò–î–ê–õ–ï–ù–ù–Ø',
                [LOG_TYPES.VIEW_CASE]: '–ü–ï–†–ï–ì–õ–Ø–î',
                [LOG_TYPES.EXPORT_DATA]: '–ï–ö–°–ü–û–†–¢',
                [LOG_TYPES.SYSTEM]: '–°–ò–°–¢–ï–ú–ê'
            };
            return types[type] || type;
        }

        function getLogStatusColor(log) {
            if (log.type === LOG_TYPES.DELETE_CASE) return 'danger';
            if (log.type === LOG_TYPES.LOGIN && log.details.status === 'failed') return 'warning';
            if (log.type === LOG_TYPES.CREATE_CASE) return 'success';
            return 'primary';
        }

        function getAgencyName(agency) {
            const agencies = {
                'gunp': '–ì–£–ù–ü',
                'sbu': '–°–ë–£',
                'prosecutor': '–ü—Ä–æ–∫—É—Ä–∞—Ç—É—Ä–∞',
                'system': '–°–∏—Å—Ç–µ–º–∞'
            };
            return agencies[agency] || agency;
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤
        function filterLogs(filterType, value) {
            let filteredLogs = SYSTEM_LOGS.logs;

            if (filterType === 'type' && value) {
                filteredLogs = filteredLogs.filter(log => log.type === value);
            } else if (filterType === 'user' && value) {
                filteredLogs = filteredLogs.filter(log => log.username === value);
            } else if (filterType === 'agency' && value) {
                filteredLogs = filteredLogs.filter(log => log.agency === value);
            }

            renderLogs(filteredLogs);
        }

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function populateUserFilter() {
            const userFilter = document.getElementById('log-user-filter');
            const uniqueUsers = [...new Set(SYSTEM_LOGS.logs.map(log => log.username))];
            
            userFilter.innerHTML = '<option value="">–í—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</option>' +
                uniqueUsers.map(user => `<option value="${user}">${user}</option>`).join('');
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
        function exportAllLogs() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "–î–∞—Ç–∞,–¢–∏–ø,–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á,–í—ñ–¥–æ–º—Å—Ç–≤–æ,–î—ñ—è,–î–µ—Ç–∞–ª—ñ,IP\n"
                + SYSTEM_LOGS.logs.map(log => 
                    `"${new Date(log.timestamp).toLocaleString('uk-UA')}","${getLogTypeText(log.type)}","${log.user}","${getAgencyName(log.agency)}","${log.action}","${getLogDetailsText(log)}","${log.ip}"`
                  ).join("\n");
            
            downloadCSV(csvContent, `system_logs_${new Date().toISOString().split('T')[0]}.csv`);
            showNotification('–ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ –≤—Å—ñ –ª–æ–≥–∏ —Å–∏—Å—Ç–µ–º–∏');
        }

        function downloadCSV(content, filename) {
            const encodedUri = encodeURI(content);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.background = type === 'success' ? 'var(--success)' : 'var(--danger)';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // üîÑ –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –°–ò–°–¢–ï–ú–´

        function selectAgency(agency) {
            currentAgency = agency;
            const agencyData = getAgencyData(agency);
            
            document.getElementById('modal-agency-name').textContent = agencyData.fullName;
            document.getElementById('modal-agency-desc').textContent = `–í—Ö—ñ–¥ –¥–æ —Å–∏—Å—Ç–µ–º–∏ ${agencyData.name}`;
            document.getElementById('modal-avatar').textContent = agencyData.icon;
            document.getElementById('modal-avatar').style.background = agencyData.color;
            
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            
            showPasswordsForAgency(agency);
            document.getElementById('loginModal').style.display = 'flex';
        }

        function showPasswordsForAgency(agency) {
            const passwordList = document.getElementById('passwordList');
            const users = USERS[agency];
            
            passwordList.innerHTML = users.map(user => `
                <div class="password-item">
                    <span>${user.username}</span>
                    <span>${user.password}</span>
                </div>
            `).join('');
        }

        function getAgencyData(agency) {
            const agencies = {
                gunp: { name: "–ì–£–ù–ü", fullName: "–ì–æ–ª–æ–≤–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—ó –ø–æ–ª—ñ—Ü—ñ—ó", color: "#1e40af", icon: "üëÆ‚Äç‚ôÇÔ∏è" },
                sbu: { name: "–°–ë–£", fullName: "–°–ª—É–∂–±–∞ –ë–µ–∑–ø–µ–∫–∏ –£–∫—Ä–∞—ó–Ω–∏", color: "#dc2626", icon: "üïµÔ∏è‚Äç‚ôÇÔ∏è" },
                prosecutor: { name: "–ü—Ä–æ–∫—É—Ä–∞—Ç—É—Ä–∞", fullName: "–ì–µ–Ω–µ—Ä–∞–ª—å–Ω–∞ –ø—Ä–æ–∫—É—Ä–∞—Ç—É—Ä–∞ –£–∫—Ä–∞—ó–Ω–∏", color: "#7c2d12", icon: "‚öñÔ∏è" },
                admin: { name: "–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å", fullName: "–ü–∞–Ω–µ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–∏—Å—Ç–µ–º–∏", color: "#7e22ce", icon: "üë®‚Äçüíº" }
            };
            return agencies[agency];
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!');
                return;
            }
            
            const user = USERS[currentAgency].find(u => 
                u.username === username && u.password === password
            );
            
            if (user) {
                currentUser = user;
                
                logAction(LOG_TYPES.LOGIN, '–£—Å–ø—ñ—à–Ω–∏–π –≤—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É', {
                    username: username,
                    status: 'success',
                    agency: currentAgency
                }, user);
                
                closeLoginModal();
                showAgencyPanel();
                loadCasesForAgency();
                showNotification(`–í—ñ—Ç–∞—î–º–æ, ${user.name}!`, 'success');
            } else {
                logAction(LOG_TYPES.LOGIN, '–ù–µ–≤–¥–∞–ª–∞ —Å–ø—Ä–æ–±–∞ –≤—Ö–æ–¥—É', {
                    username: username,
                    status: 'failed',
                    agency: currentAgency
                });
                
                alert('–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø–∞—Ä–æ–ª—ñ –∑—ñ —Å–ø–∏—Å–∫—É –Ω–∏–∂—á–µ.');
            }
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        function togglePassword() {
            const passwordInput = document.getElementById('loginPassword');
            const toggleButton = document.querySelector('.toggle-password');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.textContent = 'üîí';
            } else {
                passwordInput.type = 'password';
                toggleButton.textContent = 'üëÅÔ∏è';
            }
        }

        function toggleProsecutorPassword() {
            const passwordInput = document.getElementById('prosecutorPassword');
            const toggleButtons = document.querySelectorAll('.toggle-password');
            const toggleButton = toggleButtons[toggleButtons.length - 1];
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.textContent = 'üîí';
            } else {
                passwordInput.type = 'password';
                toggleButton.textContent = 'üëÅÔ∏è';
            }
        }

        function showAgencyPanel() {
            document.querySelectorAll('.admin-panel').forEach(panel => {
                panel.style.display = 'none';
            });
            
            document.getElementById(`${currentAgency}-panel`).style.display = 'block';
        }

        function showAdminTab(tabName) {
            // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –≤—Å—ñ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.admin-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // –í–∏–¥–∞–ª—è—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π –∫–ª–∞—Å –∑ —É—Å—ñ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –æ–±—Ä–∞–Ω—É –≤–∫–ª–∞–¥–∫—É
            document.getElementById(`admin-${tabName}`).style.display = 'block';
            
            // –î–æ–¥–∞—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π –∫–ª–∞—Å –¥–æ –ø–æ—Ç–æ—á–Ω–æ—ó –∫–Ω–æ–ø–∫–∏
            event.target.classList.add('active');

            // –Ø–∫—â–æ —Ü–µ –≤–∫–ª–∞–¥–∫–∞ –ª–æ–≥—ñ–≤ - –æ–Ω–æ–≤–ª—é—î–º–æ –ª–æ–≥–∏
            if (tabName === 'logs') {
                renderLogs();
            }
        }

        function logout() {
            if (currentUser) {
                logAction(LOG_TYPES.LOGOUT, '–í–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏', {}, currentUser);
            }
            currentAgency = null;
            currentUser = null;
            document.querySelectorAll('.admin-panel').forEach(panel => {
                panel.style.display = 'none';
            });
            showNotification('–î–æ –ø–æ–±–∞—á–µ–Ω–Ω—è!');
        }

        // üî• –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–û–ë–ê–í–õ–ï–ù–ò–Ø –î–ï–õ–ê
        function showAddCaseModal() {
            console.log('üîÑ showAddCaseModal –≤—ã–∑–≤–∞–Ω–∞');
            document.getElementById('addCaseModal').style.display = 'flex';
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
            document.getElementById('caseTitle').value = '';
            document.getElementById('caseDescription').value = '';
            document.getElementById('caseNumber').value = '';
            document.getElementById('caseCategory').value = 'criminal';
            document.getElementById('casePriority').value = 'medium';
        }

        function closeAddCaseModal() {
            document.getElementById('addCaseModal').style.display = 'none';
        }

        function addNewCase() {
            console.log('üîÑ addNewCase –≤—ã–∑–≤–∞–Ω–∞');
            
            const title = document.getElementById('caseTitle').value;
            const description = document.getElementById('caseDescription').value;
            const number = document.getElementById('caseNumber').value;
            const category = document.getElementById('caseCategory').value;
            const priority = document.getElementById('casePriority').value;
            
            if (!title || !number) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è: –ù–∞–∑–≤–∞ —Ç–∞ –ù–æ–º–µ—Ä —Å–ø—Ä–∞–≤–∏!');
                return;
            }
            
            const newCase = {
                id: Date.now(),
                number: number,
                title: title,
                description: description,
                category: category,
                priority: priority,
                status: 'new',
                createdDate: new Date().toLocaleDateString('uk-UA'),
                createdBy: currentUser.name,
                responsible: currentUser.name,
                agency: currentAgency
            };
            
            CASES_DATABASE[currentAgency].push(newCase);
            updateStatistics();
            loadCasesForAgency();
            closeAddCaseModal();
            
            logAction(LOG_TYPES.CREATE_CASE, '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó —Å–ø—Ä–∞–≤–∏', {
                caseNumber: number,
                caseTitle: title,
                category: category,
                priority: priority
            }, currentUser);
            
            showNotification(`–°–ø—Ä–∞–≤–∞ "${title}" —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∞!`, 'success');
        }

        function loadCasesForAgency() {
            if (!currentAgency || currentAgency === 'admin') return;
            
            const cases = CASES_DATABASE[currentAgency];
            const tableBody = document.getElementById(`${currentAgency}-cases-table`);
            
            tableBody.innerHTML = cases.map(caseItem => `
                <tr>
                    <td>${caseItem.number}</td>
                    <td>${caseItem.title}</td>
                    <td><span class="badge case-status-${caseItem.status}">${getStatusText(caseItem.status)}</span></td>
                    <td>${caseItem.createdDate}</td>
                    <td>${caseItem.responsible}</td>
                    <td class="case-actions">
                        <button class="btn btn-primary" onclick="viewCase(${caseItem.id})">üëÅÔ∏è –ü–µ—Ä–µ–≥–ª—è–¥</button>
                        ${currentAgency === 'prosecutor' ? 
                          `<button class="btn btn-danger" onclick="requestCaseDeletion(${caseItem.id})">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>` : 
                          `<button class="btn" disabled title="–¢—ñ–ª—å–∫–∏ –ø—Ä–æ–∫—É—Ä–∞—Ç—É—Ä–∞ –º–æ–∂–µ –≤–∏–¥–∞–ª—è—Ç–∏ —Å–ø—Ä–∞–≤–∏">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>`
                        }
                    </td>
                </tr>
            `).join('');
            
            updateStatistics();
        }

        function getStatusText(status) {
            const statuses = {
                'new': '–ù–æ–≤–∞',
                'in-progress': '–í —Ä–æ–±–æ—Ç—ñ',
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω–∞',
                'closed': '–ó–∞–∫—Ä–∏—Ç–∞'
            };
            return statuses[status] || status;
        }

        function updateStatistics() {
            if (!currentAgency) return;
            
            const cases = CASES_DATABASE[currentAgency];
            const totalCases = cases.length;
            const activeCases = cases.filter(c => c.status === 'new' || c.status === 'in-progress').length;
            const criticalCases = cases.filter(c => c.priority === 'critical').length;
            
            document.getElementById(`${currentAgency}-total-cases`).textContent = totalCases;
            document.getElementById(`${currentAgency}-active-cases`).textContent = activeCases;
            document.getElementById(`${currentAgency}-critical-cases`).textContent = criticalCases;
        }

        function viewCase(caseId) {
            const caseItem = CASES_DATABASE[currentAgency].find(c => c.id === caseId);
            if (caseItem) {
                logAction(LOG_TYPES.VIEW_CASE, '–ü–µ—Ä–µ–≥–ª—è–¥ —Å–ø—Ä–∞–≤–∏', {
                    caseNumber: caseItem.number,
                    caseTitle: caseItem.title
                }, currentUser);
                
                alert(`–ü–µ—Ä–µ–≥–ª—è–¥ —Å–ø—Ä–∞–≤–∏:\n\n–ù–æ–º–µ—Ä: ${caseItem.number}\n–ù–∞–∑–≤–∞: ${caseItem.title}\n–û–ø–∏—Å: ${caseItem.description}\n–°—Ç–∞—Ç—É—Å: ${getStatusText(caseItem.status)}\n–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç: ${caseItem.priority}\n–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π: ${caseItem.responsible}`);
            }
        }

        function requestCaseDeletion(caseId) {
            if (currentAgency !== 'prosecutor') {
                alert('–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É! –¢—ñ–ª—å–∫–∏ –ø—Ä–æ–∫—É—Ä–∞—Ç—É—Ä–∞ –º–æ–∂–µ –≤–∏–¥–∞–ª—è—Ç–∏ —Å–ø—Ä–∞–≤–∏.');
                return;
            }
            
            const caseItem = CASES_DATABASE[currentAgency].find(c => c.id === caseId);
            if (!caseItem) return;
            
            caseToDelete = caseId;
            
            document.getElementById('caseToDeleteInfo').innerHTML = `
                <h4>üìã –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–ø—Ä–∞–≤—É:</h4>
                <p><strong>–ù–æ–º–µ—Ä:</strong> ${caseItem.number}</p>
                <p><strong>–ù–∞–∑–≤–∞:</strong> ${caseItem.title}</p>
                <p><strong>–°—Ç–≤–æ—Ä–µ–Ω–∞:</strong> ${caseItem.createdDate}</p>
                <p><strong>–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π:</strong> ${caseItem.responsible}</p>
            `;
            
            document.getElementById('prosecutorUsername').value = '';
            document.getElementById('prosecutorPassword').value = '';
            
            document.getElementById('prosecutorConfirmModal').style.display = 'flex';
        }

        function closeProsecutorConfirmModal() {
            document.getElementById('prosecutorConfirmModal').style.display = 'none';
            caseToDelete = null;
        }

        function confirmCaseDeletion() {
            const username = document.getElementById('prosecutorUsername').value;
            const password = document.getElementById('prosecutorPassword').value;
            
            if (!username || !password) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω —Ç–∞ –ø–∞—Ä–æ–ª—å –ø—Ä–æ–∫—É—Ä–æ—Ä–∞ –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è!');
                return;
            }
            
            const prosecutor = USERS.prosecutor.find(u => 
                u.username === username && u.password === password
            );
            
            if (!prosecutor) {
                alert('–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å –ø—Ä–æ–∫—É—Ä–æ—Ä–∞! –í–∏–¥–∞–ª–µ–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ.');
                return;
            }
            
            const caseItem = CASES_DATABASE[currentAgency].find(c => c.id === caseToDelete);
            CASES_DATABASE[currentAgency] = CASES_DATABASE[currentAgency].filter(c => c.id !== caseToDelete);
            loadCasesForAgency();
            closeProsecutorConfirmModal();
            
            logAction(LOG_TYPES.DELETE_CASE, '–í–∏–¥–∞–ª–µ–Ω–Ω—è —Å–ø—Ä–∞–≤–∏', {
                caseNumber: caseItem.number,
                caseTitle: caseItem.title,
                confirmedBy: prosecutor.name
            }, currentUser);
            
            showNotification(`–°–ø—Ä–∞–≤—É —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ!\n–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ –ø—Ä–æ–∫—É—Ä–æ—Ä–æ–º: ${prosecutor.name}`);
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
        function initializeTestData() {
            CASES_DATABASE.gunp.push({
                id: 1,
                number: "210/2024",
                title: "–†–æ–∑–∫—Ä–∞–¥–∞–Ω–Ω—è –∫–æ—à—Ç—ñ–≤ –±—é–¥–∂–µ—Ç—É",
                description: "–°–ø—Ä–∞–≤–∞ –ø—Ä–æ —Ä–æ–∑–∫—Ä–∞–¥–∞–Ω–Ω—è –∫–æ—à—Ç—ñ–≤ –º—ñ—Å—Ü–µ–≤–æ–≥–æ –±—é–¥–∂–µ—Ç—É",
                category: "criminal",
                priority: "high",
                status: "in-progress",
                createdDate: "15.01.2024",
                createdBy: "–ö–æ–≤–∞–ª–µ–Ω–∫–æ –Ü.–ü.",
                responsible: "–ü–µ—Ç—Ä–µ–Ω–∫–æ –û.–í.",
                agency: "gunp"
            });

            CASES_DATABASE.sbu.push({
                id: 2,
                number: "–°–ë–£-45/2024",
                title: "–ö–æ–Ω—Ç—Ä—Ä–æ–∑–≤—ñ–¥—É–≤–∞–ª—å–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è",
                description: "–û–ø–µ—Ä–∞—Ü—ñ—è –∑ –≤–∏—è–≤–ª–µ–Ω–Ω—è —ñ–Ω–æ–∑–µ–º–Ω–∏—Ö –∞–≥–µ–Ω—Ç—ñ–≤",
                category: "operational",
                priority: "critical",
                status: "in-progress",
                createdDate: "14.01.2024",
                createdBy: "–ú–µ–ª—å–Ω–∏–∫ –ê.–í.",
                responsible: "–ö–æ–≤–∞–ª—å—á—É–∫ –°.–ú.",
                agency: "sbu"
            });

            CASES_DATABASE.prosecutor.push({
                id: 3,
                number: "–ü-789/2024",
                title: "–ù–∞–≥–ª—è–¥ –∑–∞ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è–º",
                description: "–ù–∞–≥–ª—è–¥ –∑–∞ –¥–æ—Ç—Ä–∏–º–∞–Ω–Ω—è–º –∑–∞–∫–æ–Ω—É –ø—Ä–∏ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—ñ",
                category: "supervision",
                priority: "medium",
                status: "new",
                createdDate: "16.01.2024",
                createdBy: "–í—ñ—Å–∫–∞—Ä –ú.–ú.",
                responsible: "–ö—É–ª–µ–±—è–∫–∞ –ê.–ê.",
                agency: "prosecutor"
            });

            updateStatistics();
        }

        function initializeLoggingSystem() {
            loadLogsFromStorage();
            logAction(LOG_TYPES.SYSTEM, '–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞', {
                version: '2.4.1',
                userAgent: navigator.userAgent
            });
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.onload = function() {
            initializeTestData();
            initializeLoggingSystem();
            console.log('üõ°Ô∏è –Ñ–†–î–† PRO System Initialized');
            console.log('24 unique passwords + logging system loaded');
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–µ–ª–∞
            console.log('‚úÖ –ö–Ω–æ–ø–∫–∞ "–î–æ–¥–∞—Ç–∏ —Å–ø—Ä–∞–≤—É" –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
        };

        // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–ª–∞–≤—ñ—à—ñ Enter
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('loginModal').style.display === 'flex') {
                login();
            }
            
            // Enter –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–µ–ª–∞
            if (e.key === 'Enter' && document.getElementById('addCaseModal').style.display === 'flex') {
                addNewCase();
            }
        });

        // üî• –î–û–ë–ê–í–õ–Ø–ï–ú –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–ù–û–ü–û–ö
        // –≠—Ç–æ –Ω—É–∂–Ω–æ —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ –º–æ–≥–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
        window.showAddCaseModal = showAddCaseModal;
        window.addNewCase = addNewCase;
        window.closeAddCaseModal = closeAddCaseModal;
        window.viewCase = viewCase;
        window.requestCaseDeletion = requestCaseDeletion;
        window.confirmCaseDeletion = confirmCaseDeletion;
        window.closeProsecutorConfirmModal = closeProsecutorConfirmModal;
        window.toggleProsecutorPassword = toggleProsecutorPassword;
        window.filterLogs = filterLogs;
        window.exportAllLogs = exportAllLogs;
        window.showAdminTab = showAdminTab;
        window.logout = logout;
        window.selectAgency = selectAgency;
        window.login = login;
        window.closeLoginModal = closeLoginModal;
        window.togglePassword = togglePassword;
    </script>
</body>
</html>
