<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–Ñ–†–î–† PRO v3.0 - –û–±'—î–¥–Ω–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞</title>
    <style>
        /* ... –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è ... */

        .logs-section {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            max-height: 600px;
            overflow-y: auto;
        }

        .log-item {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .log-item:hover {
            background: rgba(255,255,255,0.05);
        }

        .log-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .log-meta {
            display: flex;
            gap: 15px;
            font-size: 0.8em;
            color: #94a3b8;
        }

        .log-action {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .log-details {
            color: #cbd5e1;
            font-size: 0.9em;
        }

        .log-ip {
            font-family: 'Courier New', monospace;
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .log-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .log-export-btn {
            background: var(--success);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
        }

        .real-time-badge {
            background: var(--danger);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .security-alert {
            background: rgba(220, 38, 38, 0.2);
            border: 1px solid var(--danger);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .log-type-login { border-left: 4px solid #10b981; }
        .log-type-create { border-left: 4px solid #3b82f6; }
        .log-type-delete { border-left: 4px solid #dc2626; }
        .log-type-export { border-left: 4px solid #f59e0b; }
        .log-type-view { border-left: 4px solid #8b5cf6; }
        .log-type-system { border-left: 4px solid #6b7280; }
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>

    <div class="container">
        <header class="header">
            <h1 style="font-size: 2.5em; margin-bottom: 10px;">üõ°Ô∏è –Ñ–†–î–† PRO v3.0</h1>
            <p style="color: #cbd5e1; font-size: 1.1em;">–†–æ–∑—à–∏—Ä–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è–º–∏</p>
            <div style="background: var(--danger); color: white; padding: 8px 15px; border-radius: 20px; display: inline-block; margin-top: 10px; font-weight: bold;">
                üîí –ó–ê–°–ï–ö–†–ï–ß–ï–ù–û | –ë–ê–ó–ê: 1000+ –°–ü–†–ê–í | –õ–û–ì–ò: –ê–ö–¢–ò–í–ù–Ü
            </div>
        </header>

        <!-- ... –æ—Å—Ç–∞–ª—å–Ω–æ–π HTML –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ ... -->

        <!-- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å –ª–æ–≥–∞–º–∏ -->
        <div id="admin-panel" class="admin-panel">
            <div class="admin-header">
                <div>
                    <h2>üë®‚Äçüíº –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h2>
                    <p style="color: #cbd5e1;">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–æ—é —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</p>
                </div>
                <button class="btn btn-admin" onclick="logout()">–í–∏–π—Ç–∏</button>
            </div>

            <div class="admin-tabs">
                <button class="admin-tab" onclick="showAdminTab('dashboard')">–î–∞—à–±–æ—Ä–¥</button>
                <button class="admin-tab active" onclick="showAdminTab('logs')">üìã –ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π</button>
                <button class="admin-tab" onclick="showAdminTab('security')">üõ°Ô∏è –ë–µ–∑–ø–µ–∫–∞</button>
                <button class="admin-tab" onclick="showAdminTab('users')">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</button>
                <button class="admin-tab" onclick="showAdminTab('system')">–°–∏—Å—Ç–µ–º–∞</button>
                <button class="admin-tab" onclick="showAdminTab('backup')">–†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è</button>
            </div>

            <!-- –î–∞—à–±–æ—Ä–¥ -->
            <div id="admin-dashboard" class="admin-section">
                <h3>üìä –î–∞—à–±–æ—Ä–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</h3>
                <div class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--admin-color), #6b21a8);">
                        <div class="stat-number" id="total-logs">0</div>
                        <div>–í—Å—å–æ–≥–æ –∑–∞–ø–∏—Å—ñ–≤</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #047857);">
                        <div class="stat-number" id="today-logs">0</div>
                        <div>–°—å–æ–≥–æ–¥–Ω—ñ</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #dc2626, #b91c1c);">
                        <div class="stat-number" id="failed-logins">0</div>
                        <div>–ù–µ–≤–¥–∞–ª–∏—Ö –≤—Ö–æ–¥—ñ–≤</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <div class="stat-number" id="active-users">0</div>
                        <div>–ê–∫—Ç–∏–≤–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</div>
                    </div>
                </div>

                <div class="quick-actions">
                    <div class="quick-action-card" onclick="showAdminTab('logs')">
                        <h3>üìã –í—Å—ñ –ª–æ–≥–∏</h3>
                        <div>–ü–æ–≤–Ω–∏–π –∂—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π</div>
                    </div>
                    <div class="quick-action-card" onclick="filterLogs('type', 'login')">
                        <h3>üîê –í—Ö–æ–¥–∏</h3>
                        <div>–Ü—Å—Ç–æ—Ä—ñ—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ–π</div>
                    </div>
                    <div class="quick-action-card" onclick="filterLogs('type', 'delete')">
                        <h3>üóëÔ∏è –í–∏–¥–∞–ª–µ–Ω–Ω—è</h3>
                        <div>–û–ø–µ—Ä–∞—Ü—ñ—ó –≤–∏–¥–∞–ª–µ–Ω–Ω—è</div>
                    </div>
                    <div class="quick-action-card" onclick="exportAllLogs()">
                        <h3>üíæ –ï–∫—Å–ø–æ—Ä—Ç</h3>
                        <div>–ï–∫—Å–ø–æ—Ä—Ç –≤—Å—ñ—Ö –ª–æ–≥—ñ–≤</div>
                    </div>
                </div>
            </div>

            <!-- –ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π -->
            <div id="admin-logs" class="admin-section">
                <div class="section-header">
                    <h3>üìã –ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ <span class="real-time-badge">LIVE</span></h3>
                    <div>
                        <div class="log-filters">
                            <select class="filter-select" id="log-type-filter" onchange="filterLogs('type', this.value)">
                                <option value="">–í—Å—ñ —Ç–∏–ø–∏</option>
                                <option value="login">–í—Ö–æ–¥–∏</option>
                                <option value="create">–°—Ç–≤–æ—Ä–µ–Ω–Ω—è</option>
                                <option value="delete">–í–∏–¥–∞–ª–µ–Ω–Ω—è</option>
                                <option value="export">–ï–∫—Å–ø–æ—Ä—Ç</option>
                                <option value="view">–ü–µ—Ä–µ–≥–ª—è–¥</option>
                                <option value="system">–°–∏—Å—Ç–µ–º–∞</option>
                            </select>
                            <select class="filter-select" id="log-user-filter" onchange="filterLogs('user', this.value)">
                                <option value="">–í—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</option>
                            </select>
                            <select class="filter-select" id="log-agency-filter" onchange="filterLogs('agency', this.value)">
                                <option value="">–í—Å—ñ –≤—ñ–¥–æ–º—Å—Ç–≤–∞</option>
                                <option value="gunp">–ì–£–ù–ü</option>
                                <option value="sbu">–°–ë–£</option>
                                <option value="prosecutor">–ü—Ä–æ–∫—É—Ä–∞—Ç—É—Ä–∞</option>
                            </select>
                            <input type="date" class="filter-select" id="log-date-filter" onchange="filterLogs('date', this.value)">
                            <button class="log-export-btn" onclick="exportFilteredLogs()">–ï–∫—Å–ø–æ—Ä—Ç</button>
                            <button class="btn btn-danger" onclick="clearOldLogs()">–û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞—Ä—ñ</button>
                        </div>
                    </div>
                </div>

                <div class="logs-section">
                    <div id="logs-container">
                        <!-- –õ–æ–≥–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>
                </div>
                <div class="pagination" id="logs-pagination">
                    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –ª–æ–≥–æ–≤ -->
                </div>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
            <div id="admin-security" class="admin-section" style="display: none;">
                <h3>üõ°Ô∏è –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–ø–µ–∫–∏</h3>
                
                <div class="security-alert">
                    <h4>üö® –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏</h4>
                    <p>–°–∏—Å—Ç–µ–º–∞ –≤–∏—è–≤–∏–ª–∞ –ø—ñ–¥–æ–∑—Ä—ñ–ª—É –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:</p>
                    <ul id="security-alerts-list">
                        <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
                    </ul>
                </div>

                <div class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, #dc2626, #b91c1c);">
                        <div class="stat-number" id="suspicious-logins">0</div>
                        <div>–ü—ñ–¥–æ–∑—Ä—ñ–ª–∏—Ö –≤—Ö–æ–¥—ñ–≤</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <div class="stat-number" id="failed-attempts">0</div>
                        <div>–ù–µ–≤–¥–∞–ª–∏—Ö —Å–ø—Ä–æ–±</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                        <div class="stat-number" id="ip-addresses">0</div>
                        <div>–£–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö IP</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #047857);">
                        <div class="stat-number" id="blocked-users">0</div>
                        <div>–ó–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö</div>
                    </div>
                </div>

                <h4>–û—Å—Ç–∞–Ω–Ω—ñ –ø—ñ–¥–æ–∑—Ä—ñ–ª—ñ –ø–æ–¥—ñ—ó</h4>
                <div class="logs-section">
                    <div id="security-logs-container">
                        <!-- –õ–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
                    </div>
                </div>
            </div>

            <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ (users, system, backup) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
        </div>
    </div>

    <script>
        // üî• –°–ò–°–¢–ï–ú–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø
        const SYSTEM_LOGS = {
            logs: [],
            securityAlerts: [],
            failedLogins: [],
            userSessions: new Map()
        };

        // –¢–∏–ø—ã –ª–æ–≥–æ–≤
        const LOG_TYPES = {
            LOGIN: 'login',
            LOGOUT: 'logout',
            CREATE_CASE: 'create',
            DELETE_CASE: 'delete',
            VIEW_CASE: 'view',
            EXPORT_DATA: 'export',
            SYSTEM: 'system',
            SECURITY: 'security'
        };

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ IP (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
        function generateRandomIP() {
            return `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
        }

        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function logAction(type, action, details = {}, user = null, agency = null) {
            const logEntry = {
                id: Date.now() + Math.random(),
                timestamp: new Date().toISOString(),
                type: type,
                action: action,
                details: details,
                user: user || (currentUser ? currentUser.name : '–°–∏—Å—Ç–µ–º–∞'),
                username: user ? user.username : (currentUser ? currentUser.username : 'system'),
                agency: agency || currentAgency || 'system',
                ip: generateRandomIP(),
                userAgent: navigator.userAgent,
                sessionId: Math.random().toString(36).substr(2, 9)
            };

            SYSTEM_LOGS.logs.unshift(logEntry); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            checkSecurityThreats(logEntry);

            // –û–±–Ω–æ–≤–ª—è–µ–º UI –µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–∞ –ø–∞–Ω–µ–ª—å –ª–æ–≥–æ–≤
            if (document.getElementById('admin-logs').style.display !== 'none') {
                renderLogs();
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage (–≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
            saveLogsToStorage();

            console.log(`üìù LOG [${type}]: ${action}`, logEntry);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–≥—Ä–æ–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function checkSecurityThreats(logEntry) {
            // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
            if (logEntry.type === LOG_TYPES.LOGIN && logEntry.details.status === 'failed') {
                SYSTEM_LOGS.failedLogins.push(logEntry);
                
                const recentFailures = SYSTEM_LOGS.failedLogins.filter(
                    log => log.timestamp > new Date(Date.now() - 15 * 60 * 1000).toISOString()
                ).length;

                if (recentFailures >= 3) {
                    const alert = {
                        id: Date.now(),
                        type: 'multiple_failures',
                        message: `–ü—ñ–¥–æ–∑—Ä—ñ–ª–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: ${recentFailures} –Ω–µ–≤–¥–∞–ª–∏—Ö —Å–ø—Ä–æ–± –≤—Ö–æ–¥—É –∑ IP ${logEntry.ip}`,
                        severity: 'high',
                        timestamp: new Date().toISOString()
                    };
                    SYSTEM_LOGS.securityAlerts.unshift(alert);
                    updateSecurityDashboard();
                }
            }

            // –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–Ω–æ—á—å)
            const hour = new Date().getHours();
            if ((hour < 6 || hour > 22) && logEntry.type !== LOG_TYPES.SYSTEM) {
                const alert = {
                    id: Date.now(),
                    type: 'unusual_time',
                    message: `–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –≤ –Ω–µ–∑–≤–∏—á–Ω–∏–π —á–∞—Å: ${logEntry.user} –æ ${hour}:00`,
                    severity: 'medium',
                    timestamp: new Date().toISOString()
                };
                SYSTEM_LOGS.securityAlerts.unshift(alert);
                updateSecurityDashboard();
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –≤ localStorage
        function saveLogsToStorage() {
            try {
                localStorage.setItem('erdr_system_logs', JSON.stringify(SYSTEM_LOGS.logs.slice(0, 1000))); // –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ 1000 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
                localStorage.setItem('erdr_security_alerts', JSON.stringify(SYSTEM_LOGS.securityAlerts.slice(0, 100)));
            } catch (e) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ª–æ–≥—ñ–≤:', e);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤ –∏–∑ localStorage
        function loadLogsFromStorage() {
            try {
                const savedLogs = localStorage.getItem('erdr_system_logs');
                const savedAlerts = localStorage.getItem('erdr_security_alerts');
                
                if (savedLogs) {
                    SYSTEM_LOGS.logs = JSON.parse(savedLogs);
                }
                if (savedAlerts) {
                    SYSTEM_LOGS.securityAlerts = JSON.parse(savedAlerts);
                }
            } catch (e) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª–æ–≥—ñ–≤:', e);
            }
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
        function renderLogs(filteredLogs = null) {
            const logsToRender = filteredLogs || SYSTEM_LOGS.logs;
            const container = document.getElementById('logs-container');
            
            container.innerHTML = logsToRender.map(log => `
                <div class="log-item log-type-${log.type}">
                    <div class="log-info">
                        <div class="log-action">${getLogActionText(log)}</div>
                        <div class="log-details">${getLogDetailsText(log)}</div>
                        <div class="log-meta">
                            <span>üë§ ${log.user}</span>
                            <span>üè¢ ${getAgencyName(log.agency)}</span>
                            <span>üåê <span class="log-ip">${log.ip}</span></span>
                            <span>üïí ${new Date(log.timestamp).toLocaleString('uk-UA')}</span>
                        </div>
                    </div>
                    <div class="badge badge-${getLogStatusColor(log)}">${getLogTypeText(log.type)}</div>
                </div>
            `).join('');

            updateLogsStatistics();
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
        function getLogActionText(log) {
            const actions = {
                [LOG_TYPES.LOGIN]: `–í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É`,
                [LOG_TYPES.LOGOUT]: `–í–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏`,
                [LOG_TYPES.CREATE_CASE]: `–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–ø—Ä–∞–≤–∏`,
                [LOG_TYPES.DELETE_CASE]: `–í–∏–¥–∞–ª–µ–Ω–Ω—è —Å–ø—Ä–∞–≤–∏`,
                [LOG_TYPES.VIEW_CASE]: `–ü–µ—Ä–µ–≥–ª—è–¥ —Å–ø—Ä–∞–≤–∏`,
                [LOG_TYPES.EXPORT_DATA]: `–ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö`,
                [LOG_TYPES.SYSTEM]: `–°–∏—Å—Ç–µ–º–Ω–∞ –ø–æ–¥—ñ—è`,
                [LOG_TYPES.SECURITY]: `–ü–æ–¥—ñ—è –±–µ–∑–ø–µ–∫–∏`
            };
            return actions[log.type] || log.action;
        }

        function getLogDetailsText(log) {
            switch (log.type) {
                case LOG_TYPES.LOGIN:
                    return `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${log.details.username} ‚Ä¢ –°—Ç–∞—Ç—É—Å: ${log.details.status === 'success' ? '–£—Å–ø—ñ—à–Ω–æ' : '–ù–µ–≤–¥–∞–ª–æ'}`;
                case LOG_TYPES.CREATE_CASE:
                    return `–°–ø—Ä–∞–≤–∞: ${log.details.caseNumber} ‚Ä¢ ${log.details.caseTitle}`;
                case LOG_TYPES.DELETE_CASE:
                    return `–°–ø—Ä–∞–≤–∞: ${log.details.caseNumber} ‚Ä¢ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ: ${log.details.confirmedBy}`;
                case LOG_TYPES.VIEW_CASE:
                    return `–°–ø—Ä–∞–≤–∞: ${log.details.caseNumber}`;
                case LOG_TYPES.EXPORT_DATA:
                    return `–ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ: ${log.details.recordCount} –∑–∞–ø–∏—Å—ñ–≤ ‚Ä¢ –§–æ—Ä–º–∞—Ç: ${log.details.format}`;
                default:
                    return log.details.message || '';
            }
        }

        function getLogTypeText(type) {
            const types = {
                [LOG_TYPES.LOGIN]: '–í–•–Ü–î',
                [LOG_TYPES.LOGOUT]: '–í–ò–•–Ü–î',
                [LOG_TYPES.CREATE_CASE]: '–°–¢–í–û–†–ï–ù–ù–Ø',
                [LOG_TYPES.DELETE_CASE]: '–í–ò–î–ê–õ–ï–ù–ù–Ø',
                [LOG_TYPES.VIEW_CASE]: '–ü–ï–†–ï–ì–õ–Ø–î',
                [LOG_TYPES.EXPORT_DATA]: '–ï–ö–°–ü–û–†–¢',
                [LOG_TYPES.SYSTEM]: '–°–ò–°–¢–ï–ú–ê',
                [LOG_TYPES.SECURITY]: '–ë–ï–ó–ü–ï–ö–ê'
            };
            return types[type] || type;
        }

        function getLogStatusColor(log) {
            if (log.type === LOG_TYPES.DELETE_CASE || log.type === LOG_TYPES.SECURITY) return 'danger';
            if (log.type === LOG_TYPES.LOGIN && log.details.status === 'failed') return 'warning';
            if (log.type === LOG_TYPES.CREATE_CASE) return 'success';
            return 'primary';
        }

        function getAgencyName(agency) {
            const agencies = {
                'gunp': '–ì–£–ù–ü',
                'sbu': '–°–ë–£',
                'prosecutor': '–ü—Ä–æ–∫—É—Ä–∞—Ç—É—Ä–∞',
                'system': '–°–∏—Å—Ç–µ–º–∞'
            };
            return agencies[agency] || agency;
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–≥–æ–≤
        function filterLogs(filterType, value) {
            let filteredLogs = SYSTEM_LOGS.logs;

            if (filterType === 'type' && value) {
                filteredLogs = filteredLogs.filter(log => log.type === value);
            } else if (filterType === 'user' && value) {
                filteredLogs = filteredLogs.filter(log => log.username === value);
            } else if (filterType === 'agency' && value) {
                filteredLogs = filteredLogs.filter(log => log.agency === value);
            } else if (filterType === 'date' && value) {
                filteredLogs = filteredLogs.filter(log => log.timestamp.startsWith(value));
            }

            renderLogs(filteredLogs);
            populateUserFilter();
        }

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function populateUserFilter() {
            const userFilter = document.getElementById('log-user-filter');
            const uniqueUsers = [...new Set(SYSTEM_LOGS.logs.map(log => log.username))];
            
            userFilter.innerHTML = '<option value="">–í—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</option>' +
                uniqueUsers.map(user => `<option value="${user}">${user}</option>`).join('');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ª–æ–≥–æ–≤
        function updateLogsStatistics() {
            const today = new Date().toDateString();
            const todayLogs = SYSTEM_LOGS.logs.filter(log => 
                new Date(log.timestamp).toDateString() === today
            ).length;

            const failedLogins = SYSTEM_LOGS.logs.filter(log => 
                log.type === LOG_TYPES.LOGIN && log.details.status === 'failed'
            ).length;

            document.getElementById('total-logs').textContent = SYSTEM_LOGS.logs.length;
            document.getElementById('today-logs').textContent = todayLogs;
            document.getElementById('failed-logins').textContent = failedLogins;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function updateSecurityDashboard() {
            const uniqueIPs = new Set(SYSTEM_LOGS.logs.map(log => log.ip)).size;
            const failedAttempts = SYSTEM_LOGS.failedLogins.length;
            const suspiciousLogins = SYSTEM_LOGS.securityAlerts.length;

            document.getElementById('suspicious-logins').textContent = suspiciousLogins;
            document.getElementById('failed-attempts').textContent = failedAttempts;
            document.getElementById('ip-addresses').textContent = uniqueIPs;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
            const alertsList = document.getElementById('security-alerts-list');
            alertsList.innerHTML = SYSTEM_LOGS.securityAlerts.slice(0, 5).map(alert => `
                <li>${alert.message} <small>${new Date(alert.timestamp).toLocaleString('uk-UA')}</small></li>
            `).join('');
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
        function exportAllLogs() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "–î–∞—Ç–∞,–¢–∏–ø,–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á,–í—ñ–¥–æ–º—Å—Ç–≤–æ,–î—ñ—è,–î–µ—Ç–∞–ª—ñ,IP\n"
                + SYSTEM_LOGS.logs.map(log => 
                    `"${new Date(log.timestamp).toLocaleString('uk-UA')}","${getLogTypeText(log.type)}","${log.user}","${getAgencyName(log.agency)}","${log.action}","${getLogDetailsText(log)}","${log.ip}"`
                  ).join("\n");
            
            downloadCSV(csvContent, `system_logs_${new Date().toISOString().split('T')[0]}.csv`);
            showNotification('–ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ –≤—Å—ñ –ª–æ–≥–∏ —Å–∏—Å—Ç–µ–º–∏');
        }

        function exportFilteredLogs() {
            // –≠–∫—Å–ø–æ—Ä—Ç —Ç–µ–∫—É—â–∏—Ö –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤
            const visibleLogs = document.querySelectorAll('.log-item');
            if (visibleLogs.length === 0) return;

            showNotification('–ï–∫—Å–ø–æ—Ä—Ç –ø–æ—Ç–æ—á–Ω–∏—Ö —Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–∏—Ö –ª–æ–≥—ñ–≤');
        }

        function downloadCSV(content, filename) {
            const encodedUri = encodeURI(content);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
        function clearOldLogs() {
            if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω—ñ–≤?')) {
                const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
                SYSTEM_LOGS.logs = SYSTEM_LOGS.logs.filter(log => 
                    new Date(log.timestamp) > thirtyDaysAgo
                );
                saveLogsToStorage();
                renderLogs();
                showNotification('–°—Ç–∞—Ä—ñ –ª–æ–≥–∏ –æ—á–∏—â–µ–Ω–æ');
            }
        }

        // üîÑ –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø –í –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –§–£–ù–ö–¶–ò–ò

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–∞
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = USERS[currentAgency].find(u => 
                u.username === username && u.password === password
            );
            
            if (user) {
                currentUser = user;
                
                // –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
                logAction(LOG_TYPES.LOGIN, '–£—Å–ø—ñ—à–Ω–∏–π –≤—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É', {
                    username: username,
                    status: 'success',
                    agency: currentAgency
                }, user);
                
                closeLoginModal();
                showAgencyPanel();
                loadCasesForAgency();
                showNotification(`–í—ñ—Ç–∞—î–º–æ, ${user.name}!`, 'success');
            } else {
                // –õ–æ–≥–∏—Ä—É–µ–º –Ω–µ—É–¥–∞—á–Ω—É—é –ø–æ–ø—ã—Ç–∫—É –≤—Ö–æ–¥–∞
                logAction(LOG_TYPES.LOGIN, '–ù–µ–≤–¥–∞–ª–∞ —Å–ø—Ä–æ–±–∞ –≤—Ö–æ–¥—É', {
                    username: username,
                    status: 'failed',
                    agency: currentAgency
                });
                
                alert('–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å!');
            }
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–∞
        function logout() {
            if (currentUser) {
                logAction(LOG_TYPES.LOGOUT, '–í–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏', {}, currentUser);
            }
            currentAgency = null;
            currentUser = null;
            document.querySelectorAll('.admin-panel').forEach(panel => {
                panel.style.display = 'none';
            });
            showNotification('–î–æ –ø–æ–±–∞—á–µ–Ω–Ω—è!');
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–ª–∞
        function addNewCase() {
            const title = document.getElementById('caseTitle').value;
            const number = document.getElementById('caseNumber').value;
            
            // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–ª–∞ ...
            
            // –õ–æ–≥–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –¥–µ–ª–∞
            logAction(LOG_TYPES.CREATE_CASE, '–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó —Å–ø—Ä–∞–≤–∏', {
                caseNumber: number,
                caseTitle: title,
                category: document.getElementById('caseCategory').value,
                priority: document.getElementById('casePriority').value
            }, currentUser);
            
            showNotification(`–°–ø—Ä–∞–≤–∞ "${title}" —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∞!`, 'success');
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –¥–µ–ª–∞
        function confirmCaseDeletion() {
            // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —É–¥–∞–ª–µ–Ω–∏—è –¥–µ–ª–∞ ...
            
            // –õ–æ–≥–∏—Ä—É–µ–º —É–¥–∞–ª–µ–Ω–∏–µ –¥–µ–ª–∞
            logAction(LOG_TYPES.DELETE_CASE, '–í–∏–¥–∞–ª–µ–Ω–Ω—è —Å–ø—Ä–∞–≤–∏', {
                caseNumber: caseItem.number,
                caseTitle: caseItem.title,
                confirmedBy: prosecutor.name
            }, currentUser);
            
            showNotification(`–°–ø—Ä–∞–≤–∞ —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∞!`, 'success');
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∞
        function exportCases() {
            const cases = CASES_DATABASE[currentAgency];
            
            // –õ–æ–≥–∏—Ä—É–µ–º —ç–∫—Å–ø–æ—Ä—Ç
            logAction(LOG_TYPES.EXPORT_DATA, '–ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö', {
                recordCount: cases.length,
                format: 'CSV',
                agency: currentAgency
            }, currentUser);
            
            // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —ç–∫—Å–ø–æ—Ä—Ç–∞ ...
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–æ–≤
        function initializeLoggingSystem() {
            loadLogsFromStorage();
            
            // –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
            logAction(LOG_TYPES.SYSTEM, '–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞', {
                version: '3.0',
                userAgent: navigator.userAgent
            });
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
            setInterval(() => {
                logAction(LOG_TYPES.SYSTEM, '–°–∏—Å—Ç–µ–º–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥', {
                    activeUsers: SYSTEM_LOGS.userSessions.size,
                    memoryUsage: Math.round(performance.memory.usedJSHeapSize / 1048576) + 'MB'
                });
            }, 300000); // –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
            
            console.log('üìä –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞');
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            generateTestData();
            initializeLoggingSystem();
            console.log('üõ°Ô∏è –Ñ–†–î–† PRO v3.0 –∑ —Å–∏—Å—Ç–µ–º–æ—é –ª–æ–≥—É–≤–∞–Ω–Ω—è');
        };
    </script>
</body>
</html>
